# test_postgres.py
from app import app
from database import db
from sqlalchemy import inspect, text

print("ğŸ” Test de connexion PostgreSQL...")

try:
    with app.app_context():
        # test simple
        db.session.execute(text("SELECT 1"))
        print("âœ… Connexion PostgreSQL OK !")

        # afficher l'URI rÃ©ellement utilisÃ©e
        print("\nğŸ“¡ Base de donnÃ©es utilisÃ©e :")
        print("â†’", app.config.get("SQLALCHEMY_DATABASE_URI"))

        # lister les tables via l'inspector (mÃ©thode compatible)
        print("\nğŸ“‹ Tables existantes dans PostgreSQL :")
        inspector = inspect(db.engine)
        tables = inspector.get_table_names()

        if tables:
            for t in tables:
                print(" -", t)
        else:
            print("âš ï¸ Aucune table trouvÃ©e ! (exÃ©cute db.create_all() si nÃ©cessaire)")

except Exception as e:
    print("âŒ Erreur de connexion / listing :")
    print(e)
