{% extends "base.html" %}

{% block content %}
<div class="max-w-xl mx-auto bg-white shadow-xl rounded-2xl p-6 mt-6">

  <!-- Navigation -->
  <div class="flex justify-between mb-4">
    <button onclick="safeBack()"
            class="bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-800">
      â¬… Retour
    </button>

    <a href="{{ url_for('main.accueil') }}"
       class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      ğŸ  Accueil
    </a>
  </div>

  <!-- Titre -->
  <h2 class="text-2xl font-bold text-center text-blue-600 mb-6">
    ğŸ” RÃ©capitulatif de la transaction
  </h2>

  <!-- Carte rÃ©cap -->
  <div class="bg-gray-50 border rounded-xl p-4 space-y-3">

    <div class="flex justify-between">
      <span class="text-gray-600">RÃ©fÃ©rence</span>
      <span class="font-semibold">{{ conversion.reference }}</span>
    </div>

    <div class="flex justify-between">
      <span class="text-gray-600">Montant envoyÃ©</span>
      <span class="font-semibold text-blue-600">
        {{ conversion.montant_initial }} {{ conversion.from_currency }}
      </span>
    </div>

    <div class="flex justify-between">
      <span class="text-gray-600">Montant reÃ§u</span>
      <span class="font-semibold text-green-600">
        {{ conversion.montant_converti }} {{ conversion.to_currency }}
      </span>
    </div>

    <div class="flex justify-between">
      <span class="text-gray-600">Envoyeur</span>
      <span>{{ conversion.sender_phone }}</span>
    </div>

    <div class="flex justify-between">
      <span class="text-gray-600">BÃ©nÃ©ficiaire</span>
      <span>{{ conversion.receiver_phone }}</span>
    </div>

    <div class="flex justify-between">
      <span class="text-gray-600">Statut</span>
      <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-sm">
        En attente de paiement
      </span>
    </div>
  </div>

  <!-- Consentement -->
  <div class="mt-4 text-sm text-gray-600 bg-yellow-50 p-3 rounded-lg">
    âš ï¸ En continuant, vous confirmez lâ€™exactitude des informations ci-dessus.
    Cette opÃ©ration est irrÃ©versible aprÃ¨s paiement.
  </div>

  <!-- Boutons paiement -->
  <div class="mt-6 space-y-3">
    
    <button
        data-pay
        data-provider="orange"
        data-reference="{{ conversion.reference }}"
        class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600">
        ğŸŸ  Payer avec Orange Money
    </button>

    <button
        data-pay
        data-provider="wave"
        data-reference="{{ conversion.reference }}"
        class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700">
        ğŸŒŠ Payer avec Wave
    </button>


  </div>

</div>
<!--
<script>
function secureSubmit(button) {
  const provider = button.dataset.provider;
  const reference = button.dataset.reference;

  if (!provider || !reference) {
    alert("DonnÃ©es de paiement manquantes");
    return;
  }

  button.disabled = true;
  button.innerText = "Traitement en cours...";

  fetch(`/paiement/${provider}`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-CSRFToken": "{{ csrf_token() }}"
    },
    body: JSON.stringify({
      reference: reference
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.payment_url) {
      window.location.href = data.payment_url;
    } else {
      alert(data.error || "Erreur paiement");
      button.disabled = false;
      button.innerText = provider === "orange"
        ? "ğŸŸ  Payer avec Orange Money"
        : "ğŸŒŠ Payer avec Wave";
    }
  })
  .catch(() => {
    alert("Erreur rÃ©seau");
    button.disabled = false;
  });
}
</script>
-->
<script src="{{ url_for('static', filename='js/recap_payment.js') }}"></script>


{% endblock %}
