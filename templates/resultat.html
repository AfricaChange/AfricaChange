{% extends "base.html" %}
{% block content %}
<div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md mt-10 text-center">
  <h2 class="text-2xl font-bold text-green-600 mb-4">âœ… Conversion rÃ©ussie !</h2>
  
  <p class="text-gray-700 mb-2">
    {{ montant }} {{ from_currency }} âžœ 
    <span class="text-blue-600 font-semibold">{{ montant_converti }} {{ to_currency }}</span>
  </p>

  <p class="text-sm text-gray-500 mb-4">
    Taux appliquÃ© : 1 {{ from_currency }} = {{ taux }} {{ to_currency }}
  </p>

  <div class="text-left bg-gray-50 p-3 rounded-md mb-4">
    <p><strong>Envoyeur :</strong> {{ sender_phone }}</p>
    <p><strong>RÃ©cepteur :</strong> {{ receiver_phone }}</p>
    <p><strong>RÃ©fÃ©rence :</strong> {{ reference }}</p>
  </div>

  <!-- Champs cachÃ©s pour le paiement -->
  <input type="hidden" id="ref" value="{{ reference }}">
  <input type="hidden" id="montant" value="{{ montant_converti }}">
  <input type="hidden" id="sender_phone" value="{{ sender_phone }}">

  <div class="mt-4 space-y-3">

    <!-- Bouton Orange Money -->
    <button onclick="payerOrange()"
            class="bg-orange-500 text-white px-4 py-2 w-full rounded hover:bg-orange-600 transition">
      ðŸ”¶ Payer avec Orange Money
    </button>

    <!-- Bouton Wave -->
    <form action="/paiement/wave" method="POST">
     <input type="hidden" name="montant" value="{{ montant_converti }}">
     <input type="hidden" name="telephone" value="{{ sender_phone }}">

     <button class="bg-blue-600 text-white px-4 py-2 rounded">
        Payer avec Wave ðŸŒŠ
     </button>
    </form>


  </div>

  <div id="message" class="mt-4 text-lg font-semibold"></div>

  <div class="mt-6">
    <a href="{{ url_for('convert.convertir') }}" 
       class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Nouvelle conversion</a>
  </div>
</div>

<script>
function payerOrange() {
  envoyerPaiement("/paiement/orange");
}

function payerWave() {
  envoyerPaiement("/paiement/wave");
}

async function envoyerPaiement(url) {
  const ref = document.getElementById("ref").value;
  const montant = document.getElementById("montant").value;
  const telephone = document.getElementById("sender_phone").value;

  const res = await fetch(url, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      montant: montant,
      telephone: telephone,
      reference: ref
    })
  });

  const data = await res.json();
  document.getElementById("message").innerText = data.message || data.error;
}
</script>

{% endblock %}
